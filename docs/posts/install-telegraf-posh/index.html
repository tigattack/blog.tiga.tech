<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/ https://maxcdn.bootstrapcdn.com; form-action 'self'; frame-src 'self'; img-src 'self' https://avatars.githubusercontent.com https://opengraph.githubassets.com data:; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://maxcdn.bootstrapcdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com https://api.github.com;">




<meta name="author" content="tigattack">
<meta name="description" content="This is a Telegraf deployment script for Windows Server environments.">
<meta name="keywords" content="blog,personal,homelab,technology,automotive,cars">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dynamically Deploy Telegraf and Windows Monitoring Configurations with PowerShell"/>
<meta name="twitter:description" content="This is a Telegraf deployment script for Windows Server environments."/>

<meta property="og:title" content="Dynamically Deploy Telegraf and Windows Monitoring Configurations with PowerShell" />
<meta property="og:description" content="This is a Telegraf deployment script for Windows Server environments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tigattack.github.io/blog.tiga.tech/posts/install-telegraf-posh/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-11T02:33:55+01:00" />
<meta property="article:modified_time" content="2021-05-11T02:33:55+01:00" />




  <title>tig&#39;s Blog</title>

  
  <link rel="canonical" href="https://tigattack.github.io/blog.tiga.tech/posts/install-telegraf-posh/">
  

  <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/blog.tiga.tech/css/coder.min.5d4238f600e7014868f3e2e45433715d023320c118030c361103618253315b32.css" integrity="sha256-XUI49gDnAUho8&#43;LkVDNxXQIzIMEYAww2EQNhglMxWzI=" crossorigin="anonymous" media="screen" />





  
  
    
    
    <link rel="stylesheet" href="/blog.tiga.tech/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css" integrity="sha256-OeQafxa9&#43;MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin="anonymous" media="screen" />
  



   




  <link rel="icon" type="image/png" href="/blog.tiga.tech/assets/tigattack-32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/blog.tiga.tech/assets/tigattack-16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">


  

  <meta name="generator" content="Hugo 0.101.0" />


  

<link rel="stylesheet" href="/css/prism.css" />

</head>







<body class="preload-transitions line-numbers colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/blog.tiga.tech">
      tig&#39;s Blog
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/blog.tiga.tech/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/blog.tiga.tech/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/blog.tiga.tech/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/blog.tiga.tech/contact/">Contact me</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://tigattack.github.io/blog.tiga.tech/posts/install-telegraf-posh/">
              Dynamically Deploy Telegraf and Windows Monitoring Configurations with PowerShell
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2021-05-11T02:33:55&#43;01:00">
                11 May 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              4-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa fa-user" aria-hidden="true"></i>
    <a href="/blog.tiga.tech/about">tigattack</a></div>

          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/blog.tiga.tech/categories/technology/">technology</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/blog.tiga.tech/tags/powershell/">powershell</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/blog.tiga.tech/tags/telegraf/">telegraf</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/blog.tiga.tech/tags/monitoring/">monitoring</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/blog.tiga.tech/tags/metrics/">metrics</a>
    </span></div>

          <hr>
        </div>
      </header>

      <div>
        
          <img src="header.png" alt="Featured image"/>
          <hr>
        
        <p>I recently made <a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/InstallTelegraf.ps1">this script</a> to deploy the <a href="https://www.influxdata.com/time-series-platform/telegraf/">Telegraf</a> metrics agent to Windows systems.</p>
<p>This is primarily designed for Windows Server but can also be pushed to workstations.</p>
<div class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#setup">Setup</a></li>
    <li><a href="#usage">Usage</a>
      <ul>
        <li><a href="#example">Example</a>
          <ul>
            <li><a href="#screenshots">Screenshots</a></li>
            <li><a href="#commands">Commands</a></li>
          </ul>
        </li>
        <li><a href="#parameters">Parameters</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>

<h1 id="overview">
  Overview
  <a class="heading-link" href="#overview">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>This is a Telegraf deployment script for Windows Server* environments.</p>
<p>By default, the script will install a base configuration which includes:</p>
<ul>
<li>Telegraf agent as system service <em>(<a href="#parameters">configurable</a>)</em>.</li>
<li>Your pre-configured <a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf.conf"><strong>output plugin</strong></a>.</li>
<li>A comprehensive <a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf-system-metrics.conf"><strong>system metrics input plugin</strong></a> configuration.</li>
</ul>
<p>It will then scan the system to determine candidacy for the following additional input plugins:</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Configuration Applied</th>
</tr>
</thead>
<tbody>
<tr>
<td>Active Directory Domain Services</td>
<td><a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf-adds.conf">telegraf-adds.conf</a> **</td>
</tr>
<tr>
<td>DFS Namespaces</td>
<td><a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf-dfsn.conf">telegraf-dfsn.conf</a></td>
</tr>
<tr>
<td>DFS Replication</td>
<td><a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf-dfsr.conf">telegraf-dfsr.conf</a></td>
</tr>
<tr>
<td>DNS Server</td>
<td><a href="https://github.com/tigattack/Install-Telegraf-PoSH/blob/main/telegraf-dns.conf">telegraf-dns.conf</a></td>
</tr>
</tbody>
</table>
<p>I am happy to add further configurations upon request; please raise an issue or pull request, ideally with an example Telegraf configuration.</p>
<p><strong>*</strong> While this script is primarily designed for Windows Server, it will still work for Windows clients, the only difference being the additional configurations in the table above will never be installed (i.e. only the agent, output plugin, and system metrics input plugin).</p>
<p><strong>**</strong> All of the above configurations are typically (but not always) applied to domain controllers since they commonly have all of the mentioned roles installed.</p>
<p><strong>Suggested script deployment method:</strong> Group Policy computer start-up script.<br>
It is flexible in this regard though, the only requirement being that it is run on the device itself.</p>
<h1 id="requirements">
  Requirements
  <a class="heading-link" href="#requirements">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<ul>
<li>PowerShell 5.1 or higher.</li>
<li>Administrator privileges.</li>
<li>A network share with the following files in a flat structure:
<ul>
<li><code>telegraf.exe</code></li>
<li><code>telegraf.exe.sha256sum</code> *</li>
<li><code>telegraf.conf</code></li>
<li><code>telegraf-adds.conf</code></li>
<li><code>telegraf-dfsn.conf</code></li>
<li><code>telegraf-dfsr.conf</code></li>
<li><code>telegraf-dns.conf</code></li>
<li><code>telegraf-system-metrics.conf</code></li>
</ul>
</li>
</ul>
<p><strong>*</strong> This file must contain <strong>only</strong> the SHA256 sum of <code>telegraf.exe</code>.</p>
<h1 id="setup">
  Setup
  <a class="heading-link" href="#setup">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<ol>
<li>Download all the files in <a href="https://github.com/tigattack/Install-Telegraf-PoSH">the repository</a> to your desired source location (i.e. a network path). This can be done by running the commands below in PowerShell*.</li>
</ol>
<pre class="language-powershell">
<code>cd \\path\to\share # Make sure you change this
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
Invoke-WebRequest "https://github.com/tigattack/Install-Telegraf-PoSH/archive/refs/heads/main.zip" -OutFile "$env:TEMP\Install-Telegraf-PoSH.zip"
Expand-Archive -Path "$env:TEMP\Install-Telegraf-PoSH.zip" -DestinationPath "$env:TEMP\"
Remove-Item "$env:TEMP\Install-Telegraf-PoSH.zip"
Remove-Item "$env:TEMP\Install-Telegraf-PoSH-main\.github" -Recurse
Move-Item "$env:TEMP\Install-Telegraf-PoSH-main\" ".\Install-Telegraf"
</code></pre>
<ol start="2">
<li>Download the latest Telegraf release for Windows from <a href="https://github.com/influxdata/telegraf/releases">Telegraf&rsquo;s GitHub releases</a>.</li>
<li>Extract the EXE from the downloaded ZIP and move it to the source location.</li>
<li>Rename the EXE to <code>telegraf.exe</code>.</li>
<li>Open PowerShell, cd to the source directory (e.g. <code>cd \\path\to\share</code>) ,and run the following command:</li>
</ol>
<pre class="language-powershell">
<code>(Get-FileHash -Algorithm SHA256 ".\telegraf.exe").Hash | Out-File ".\telegraf.exe.sha256sum"
</code></pre>
<ol start="6">
<li>Configure your output plugin and any other Telegraf agent settings in <code>telegraf.conf</code>.</li>
</ol>
<p>Ready to go!</p>
<p><strong>*</strong> This little script is entirely safe. It instructs PowerShell to use TLS1.2 (allowing it to download from a secure (HTTPS) URL), downloads a ZIP of this repository to a temporary location, extracts the ZIP, removes the ZIP, moves this project into your destination directory, then removes the extracted directory.<br>
However, please also feel free to perform a manual download of all the files in <a href="https://github.com/tigattack/Install-Telegraf-PoSH">the repository</a> (except
<code>README.md</code> and <code>.github</code>).</p>
<h1 id="usage">
  Usage
  <a class="heading-link" href="#usage">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="example">
  Example
  <a class="heading-link" href="#example">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<h3 id="screenshots">
  Screenshots
  <a class="heading-link" href="#screenshots">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>First install:</p>
<p><img src="RaFEbuju26.png"
title="First install" loading="lazy" /></p>
<p>Update:</p>
<p><img src="zovUBIVo22.png"
title="Update" loading="lazy" /></p>
<h3 id="commands">
  Commands
  <a class="heading-link" href="#commands">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Standalone:</p>
<pre class="language-powershell">
<code>InstallTelegraf.ps1 -Source '\\path\to\share' `
    -Destination 'C:\custom\path' `
    -ServiceName 'my-telegraf' `
    -ServiceDisplayName 'My Telegraf' `
    -LogPath 'C:\Windows\TEMP\InstallTelegraf.log'
</code></pre>
<p>Standalone dry run:</p>
<pre class="language-powershell">
<code>InstallTelegraf.ps1 -Source '\\path\to\share' `
    -Destination 'C:\custom\path' `
    -ServiceName 'my-telegraf' `
    -ServiceDisplayName 'My Telegraf' `
    -LogPath 'C:\Windows\TEMP\InstallTelegraf.log' `
    -WhatIf
</code></pre>
<p>Automated Deployment:</p>
<pre class="language-powershell">
<code>PowerShell.exe -WindowStyle Hidden -File '\\path\to\InstallTelegraf.ps1' `
    -Source '\\path\to\share' `
    -Destination 'C:\custom\path' `
    -ServiceName 'my-telegraf' `
    -ServiceDisplayName 'My Telegraf' `
    -LogPath 'C:\Windows\TEMP\InstallTelegraf.log'
</code></pre>
<h2 id="parameters">
  Parameters
  <a class="heading-link" href="#parameters">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source</td>
<td>String</td>
<td>Path to network share containing Telegraf source (agent, configurations, etc.). Defaults to the script&rsquo;s parent directory.</td>
</tr>
<tr>
<td>Destination</td>
<td>String</td>
<td>Path to Telegraf destination directory. Defaults to &lsquo;C:\Program Files\Telegraf&rsquo;.</td>
</tr>
<tr>
<td>InstallService</td>
<td>Switch</td>
<td>Defaults to true but can be used to disable the installation of the Telegraf service (i.e. <code>-InstallService:$false</code>).</td>
</tr>
<tr>
<td>ServiceName</td>
<td>String</td>
<td>Telegraf service name. Defaults to &rsquo;telegraf'.</td>
</tr>
<tr>
<td>ServiceDisplayName</td>
<td>String</td>
<td>Telegraf service display name. Defaults to &lsquo;Telegraf&rsquo;.</td>
</tr>
<tr>
<td>LogPath</td>
<td>String</td>
<td>Path to log file. Defaults to &lsquo;C:\InstallTelegraf.log&rsquo;.</td>
</tr>
<tr>
<td>WhatIf</td>
<td>Switch</td>
<td>Performs a dry run.</td>
</tr>
<tr>
<td>Confirm</td>
<td>Switch</td>
<td>Prompts user for confirmation before taking action.</td>
</tr>
<tr>
<td>Verbose</td>
<td>Switch</td>
<td>Enables verbose output.</td>
</tr>
</tbody>
</table>
<hr>
<p>I always welcome feedback on my posts, please <a href="/contact">contact me</a> if you have any. I&rsquo;m also happy to answer any related questions if I know the answer.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2016 -
    
    2022
     tigattack 
    ·
    
      Licensed under <a rel="license" href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPL-3.0</a>
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Code</a>.
    
  </section>
</footer>

  </main>

  
  
  <script src="/blog.tiga.tech/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js" integrity="sha256-I2BJOV3DaC&#43;ycZZAhylY4S8fJAZ7sJwyeyM&#43;YpDH7aw="></script>
  

  

  

  

  

  

  

  

  

  

<script src='/js/prism.js'></script>
<script src='/js/gh-card.js'></script>
</body>

</html>
